import{d as z,r as u,o as I,c as l,a as t,u as E,b as k,w as C,e as D,t as T,v as N,f as O,F as R,g as $,n as q,h as H,i as J,j as s}from"./index-BFyOCESn.js";import{f as U,g as Q,_ as W,a as X,b as Z}from"./utils-DFU8xqyd.js";const ee={key:0},te={class:"toolbar"},ae=["disabled"],oe={class:"toolbar__fieldset"},le={class:"toolbar__label",for:"dateFrom"},se={key:0,class:"toolbar__fieldset"},ne=["disabled"],ue={class:"toolbar__fieldset"},ie=["value","selected"],re={key:0,class:"loading"},de={key:1,class:"error"},ve={class:"pagination"},ce=["disabled"],pe={class:"pagination__fieldset"},be=["disabled"],fe=["disabled"],_e={class:"pagination__fieldset"},me={key:1},ge={key:1},ye=!1,ke="orders",P="warehouse_name",De=30*24*60*60*1e3,we=z({__name:"OrdersView",setup(Me){const M=Q(ke),n=u(null),v=u(null),i=u(!1),V=u(100),f=u(1),Y=[["count","Количество"],["total_price","Цена"]],F=Y[0][0],c=u(F),d=u({datasets:[]}),_=u(U(new Date(Date.now()-De),"YYYY-MM-DD")),m=u(U(new Date,"YYYY-MM-DD")),S=Z();async function p(){if(M&&S&&_.value&&m.value){i.value=!0,v.value=null;const{data:o,error:e}=await X(M,"GET",{dateFrom:_.value,dateTo:m.value,page:f.value,limit:j(V.value),key:S});if(i.value=!1,e){v.value=e,n.value=null,g();return}if(!o?.data.length){v.value="Нет данных",n.value=null,g();return}n.value=o??null,f.value=o.meta.current_page,g()}}function j(o){return o<10?10:o>500?500:o}function g(){if(!n.value||!n.value.data.length){d.value={datasets:[]};return}const o=Y.find(([e])=>e===c.value)?.[1]||"Значение";if(c.value==="count"){const e={};n.value.data.forEach(b=>{const r=String(b[P]);e[r]=(e[r]||0)+1});const a=Object.keys(e),w=a.map(b=>e[b]);d.value={labels:a,datasets:[{label:o,data:w,backgroundColor:"rgba(255, 99, 132, 0.5)"}]}}else d.value=B(n.value.data,P,c.value,o)}function B(o,e,a,w="Значение",b="rgba(54, 162, 235, 0.5)"){const r={};o.forEach(y=>{const x=String(y[e]),G=Number(y[a])||0;r[x]=(r[x]||0)+G});const h=Object.keys(r),A=h.map(y=>r[y]);return{labels:h,datasets:[{label:w,data:A,backgroundColor:b}]}}function K(){f.value++,p()}function L(){f.value--,p()}return I(()=>{p()}),(o,e)=>(s(),l("div",null,[e[13]||(e[13]=t("h1",{class:"title"},"Доходы",-1)),E(M)?(s(),l("div",ee,[t("div",te,[t("form",{onSubmit:e[2]||(e[2]=C(()=>{},["prevent"])),class:"toolbar__form",action:"#",disabled:i.value},[t("fieldset",oe,[t("label",le,T("Дата с:"),1),D(t("input",{class:"toolbar__input button",type:"date",name:"dateFrom",id:"dateFrom","onUpdate:modelValue":e[0]||(e[0]=a=>_.value=a),readonly:ye},null,512),[[N,_.value]])]),(s(),l("fieldset",se,[e[7]||(e[7]=t("label",{class:"toolbar__label",for:"dateTo"},"Дата по:",-1)),D(t("input",{class:"toolbar__input button",type:"date",name:"dateTo",id:"dateTo","onUpdate:modelValue":e[1]||(e[1]=a=>m.value=a)},null,512),[[N,m.value]])])),t("button",{onClick:p,class:"button toolbar__button",type:"button"},"Показать")],40,ae),d.value?(s(),l("form",{key:0,onSubmit:e[4]||(e[4]=C(()=>{},["prevent"])),class:"toolbar__form",action:"#",disabled:i.value},[t("fieldset",ue,[e[8]||(e[8]=t("label",{class:"toolbar__label",for:"filter"},"Фильтр по:",-1)),D(t("select",{"onUpdate:modelValue":e[3]||(e[3]=a=>c.value=a),onChange:g,name:"filter",id:"filter",class:"button"},[(s(),l(R,null,$(Y,a=>t("option",{key:a[0],value:a[0],selected:a[0]===E(F)},T(a[1]),9,ie)),64))],544),[[O,c.value]])])],40,ne)):k("",!0)]),t("div",null,[i.value?(s(),l("p",re,"Загрузка...")):k("",!0),v.value?(s(),l("p",de,T(v.value),1)):k("",!0)]),d.value?(s(),l("div",{key:0,style:q({opacity:i.value?"0.5":"1"})},[H(W,{id:"chart",data:d.value},null,8,["data"]),t("div",ve,[n.value?(s(),l("form",{key:0,onSubmit:e[6]||(e[6]=C(()=>{},["prevent"])),action:"#",class:"pagination__form",disabled:i.value},[t("fieldset",pe,[t("button",{onClick:L,class:"button",type:"button",disabled:!n.value.links.prev}," Предыдущая страница ",8,be),t("button",{onClick:K,class:"button",type:"button",disabled:!n.value.links.next}," Следующая страница ",8,fe)]),t("fieldset",_e,[e[10]||(e[10]=J(" Количество на странице: ")),D(t("select",{"onUpdate:modelValue":e[5]||(e[5]=a=>V.value=a),class:"button",onChange:p},e[9]||(e[9]=[t("option",{value:"10"},"10",-1),t("option",{value:"50"},"50",-1),t("option",{value:"100"},"100",-1),t("option",{value:"500"},"500",-1)]),544),[[O,V.value]])])],40,ce)):k("",!0)])],4)):(s(),l("div",me,e[11]||(e[11]=[t("p",null,"Нет данных",-1)])))])):(s(),l("div",ge,e[12]||(e[12]=[t("p",null,"Отсутствует путь к данным",-1)])))]))}});export{we as default};
