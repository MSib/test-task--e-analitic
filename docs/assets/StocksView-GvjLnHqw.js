import{d as G,r as u,o as q,c as s,a as t,u as E,b,w as h,e as C,t as S,v as z,f as N,F as R,g as $,n as H,h as I,i as J,j as n}from"./index-BFyOCESn.js";import{f as T,g as Q,_ as W,a as X,b as Z}from"./utils-DFU8xqyd.js";const ee={key:0},te={class:"toolbar"},ae=["disabled"],oe={class:"toolbar__fieldset"},le={class:"toolbar__label",for:"dateFrom"},se=["disabled"],ne={class:"toolbar__fieldset"},ue=["value","selected"],ie={key:0,class:"loading"},re={key:1,class:"error"},de={class:"pagination"},ve=["disabled"],ce={class:"pagination__fieldset"},pe=["disabled"],fe=["disabled"],be={class:"pagination__fieldset"},_e={key:1},me={key:1},ge=!0,ye="stocks",O="warehouse_name",Ye=G({__name:"StocksView",setup(ke){const k=Q(ye),l=u(null),v=u(null),i=u(!1),D=u(100),_=u(1),M=[["quantity_full","Количество"],["price","Цена"]],V=M[0][0],c=u(V),d=u({datasets:[]}),m=u(T(new Date,"YYYY-MM-DD")),P=u(T(new Date,"YYYY-MM-DD")),w=Z();async function p(){if(k&&w&&m.value&&P.value){i.value=!0,v.value=null;const{data:o,error:e}=await X(k,"GET",{dateFrom:m.value,dateTo:void 0,page:_.value,limit:U(D.value),key:w});if(i.value=!1,e){v.value=e,l.value=null,g();return}if(!o?.data.length){v.value="Нет данных",l.value=null,g();return}l.value=o??null,_.value=o.meta.current_page,g()}}function U(o){return o<10?10:o>500?500:o}function g(){if(!l.value||!l.value.data.length){d.value={datasets:[]};return}const o=M.find(([e])=>e===c.value)?.[1]||"Значение";if(c.value==="count"){const e={};l.value.data.forEach(f=>{const r=String(f[O]);e[r]=(e[r]||0)+1});const a=Object.keys(e),Y=a.map(f=>e[f]);d.value={labels:a,datasets:[{label:o,data:Y,backgroundColor:"rgba(255, 99, 132, 0.5)"}]}}else d.value=j(l.value.data,O,c.value,o)}function j(o,e,a,Y="Значение",f="rgba(54, 162, 235, 0.5)"){const r={};o.forEach(y=>{const x=String(y[e]),A=Number(y[a])||0;r[x]=(r[x]||0)+A});const F=Object.keys(r),L=F.map(y=>r[y]);return{labels:F,datasets:[{label:Y,data:L,backgroundColor:f}]}}function B(){_.value++,p()}function K(){_.value--,p()}return q(()=>{p()}),(o,e)=>(n(),s("div",null,[e[13]||(e[13]=t("h1",{class:"title"},"Доходы",-1)),E(k)?(n(),s("div",ee,[t("div",te,[t("form",{onSubmit:e[2]||(e[2]=h(()=>{},["prevent"])),class:"toolbar__form",action:"#",disabled:i.value},[t("fieldset",oe,[t("label",le,S("Дата:"),1),C(t("input",{class:"toolbar__input button",type:"date",name:"dateFrom",id:"dateFrom","onUpdate:modelValue":e[0]||(e[0]=a=>m.value=a),readonly:ge},null,512),[[z,m.value]])]),b("",!0),t("button",{onClick:p,class:"button toolbar__button",type:"button"},"Показать")],40,ae),d.value?(n(),s("form",{key:0,onSubmit:e[4]||(e[4]=h(()=>{},["prevent"])),class:"toolbar__form",action:"#",disabled:i.value},[t("fieldset",ne,[e[8]||(e[8]=t("label",{class:"toolbar__label",for:"filter"},"Фильтр по:",-1)),C(t("select",{"onUpdate:modelValue":e[3]||(e[3]=a=>c.value=a),onChange:g,name:"filter",id:"filter",class:"button"},[(n(),s(R,null,$(M,a=>t("option",{key:a[0],value:a[0],selected:a[0]===E(V)},S(a[1]),9,ue)),64))],544),[[N,c.value]])])],40,se)):b("",!0)]),t("div",null,[i.value?(n(),s("p",ie,"Загрузка...")):b("",!0),v.value?(n(),s("p",re,S(v.value),1)):b("",!0)]),d.value?(n(),s("div",{key:0,style:H({opacity:i.value?"0.5":"1"})},[I(W,{id:"chart",data:d.value},null,8,["data"]),t("div",de,[l.value?(n(),s("form",{key:0,onSubmit:e[6]||(e[6]=h(()=>{},["prevent"])),action:"#",class:"pagination__form",disabled:i.value},[t("fieldset",ce,[t("button",{onClick:K,class:"button",type:"button",disabled:!l.value.links.prev}," Предыдущая страница ",8,pe),t("button",{onClick:B,class:"button",type:"button",disabled:!l.value.links.next}," Следующая страница ",8,fe)]),t("fieldset",be,[e[10]||(e[10]=J(" Количество на странице: ")),C(t("select",{"onUpdate:modelValue":e[5]||(e[5]=a=>D.value=a),class:"button",onChange:p},e[9]||(e[9]=[t("option",{value:"10"},"10",-1),t("option",{value:"50"},"50",-1),t("option",{value:"100"},"100",-1),t("option",{value:"500"},"500",-1)]),544),[[N,D.value]])])],40,ve)):b("",!0)])],4)):(n(),s("div",_e,e[11]||(e[11]=[t("p",null,"Нет данных",-1)])))])):(n(),s("div",me,e[12]||(e[12]=[t("p",null,"Отсутствует путь к данным",-1)])))]))}});export{Ye as default};
